<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vente - Colibri Business</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body{margin:0;font-family:Arial;background:#e6f0ff}

header{
  background:#1E3A8A;
  color:white;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:bold
}

.container{padding:16px}

label{font-weight:bold;color:#1E3A8A;margin-top:12px;display:block}
input,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px
}

textarea{resize:none;height:100px}

.upload-box{
  background:white;
  border:2px dashed #1E3A8A;
  border-radius:12px;
  padding:16px;
  text-align:center;
  margin-top:8px
}

button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#1E3A8A;
  color:white;
  font-size:16px;
  cursor:pointer
}

.option{
  margin-top:14px;
  display:flex;
  align-items:center;
  gap:8px
}
</style>
</head>

<body>

<header>Publier un produit</header>

<div class="container">

<label>Nom du produit</label>
<input id="nom" placeholder="Ex : Smartphone Samsung">

<label>Description</label>
<textarea id="desc" placeholder="Décrivez votre produit"></textarea>

<label>Prix (USD)</label>
<input id="prix" type="number" placeholder="Ex : 120">

<label>Images du produit (plusieurs)</label>
<div class="upload-box">
  <input type="file" id="images" accept="image/*" multiple>
  <small>Vous pouvez sélectionner plusieurs images</small>
</div>

<label>Vidéo du produit (optionnel)</label>
<div class="upload-box">
  <input type="file" id="video" accept="video/*">
</div>

<div class="option">
  <input type="checkbox" id="sponsor">
  <label for="sponsor">Sponsoriser ce produit (plus tard)</label>
</div>

<button onclick="publier()">Publier le produit</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyA45eoz8QZbHdFlOmuK6l6yjfJC3JaF2jQ",
  databaseURL:"https://collibri-buisiness-default-rtdb.firebaseio.com",
  projectId:"collibri-buisiness"
});
const db = getDatabase(app);

const uid = localStorage.getItem("uid") || "public";

function toBase64(file){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

window.publier = async ()=>{
  const nom=nom.value.trim();
  const desc=desc.value.trim();
  const prix=prix.value;
  if(!nom||!prix){alert("Nom et prix obligatoires");return;}

  const imgs=[];
  for(const f of images.files){
    imgs.push(await toBase64(f));
  }

  let video64="";
  if(video.files[0]) video64=await toBase64(video.files[0]);

  await push(ref(db,"produits"),{
    nom,desc,prix,
    images:imgs,
    video:video64,
    vendeurId:uid,
    sponsor:sponsor.checked,
    createdAt:Date.now()
  });

  alert("✅ Produit publié avec succès");
  location.href="achat.html";
};
</script>

</body>
</html>
