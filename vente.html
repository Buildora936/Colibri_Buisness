<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vendre un produit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body{margin:0;font-family:Arial;background:#e6f0ff}
header{background:#1E3A8A;color:white;padding:16px;text-align:center;font-size:20px}

.container{padding:16px}
input,textarea{
  width:100%;padding:12px;margin-bottom:12px;
  border-radius:10px;border:1px solid #ccc
}
button{
  width:100%;padding:14px;
  background:#1E40AF;color:white;
  border:none;border-radius:12px;
  font-size:16px;cursor:pointer
}
.preview img,video{
  width:100%;border-radius:12px;margin-bottom:10px
}
</style>
</head>

<body>

<header>Publier un produit</header>

<div class="container">

<input id="name" placeholder="Nom du produit">
<input id="price" type="number" placeholder="Prix (USD)">
<textarea id="desc" placeholder="Description du produit"></textarea>

<input type="file" id="image" accept="image/*">
<input type="file" id="video" accept="video/*">

<div class="preview" id="preview"></div>

<button onclick="publish()">Publier</button>
<p id="msg"></p>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyA45eoz8QZbHdFlOmuK6l6yjfJC3JaF2jQ",
  databaseURL:"https://collibri-buisiness-default-rtdb.firebaseio.com",
  projectId:"collibri-buisiness"
});
const db = getDatabase(app);

const uid = localStorage.getItem("uid");
if(!uid) location.href="auth.html";

let imageBase64="", videoBase64="";

image.onchange = e=>{
  const r=new FileReader();
  r.onload=()=>{ imageBase64=r.result; preview.innerHTML=`<img src="${r.result}">`; };
  r.readAsDataURL(e.target.files[0]);
};

video.onchange = e=>{
  const r=new FileReader();
  r.onload=()=>{ videoBase64=r.result; preview.innerHTML+=`<video controls src="${r.result}"></video>`; };
  r.readAsDataURL(e.target.files[0]);
};

async function publish(){
  if(!name.value || !price.value || !imageBase64){
    msg.textContent="⚠️ Champs obligatoires manquants";
    return;
  }

  await push(ref(db,"produits"),{
    nom:name.value,
    prix:price.value,
    desc:desc.value,
    image:imageBase64,
    video:videoBase64,
    vendeurId:uid,
    createdAt:Date.now()
  });

  msg.textContent="✅ Produit publié";
  setTimeout(()=>location.href="achat.html",1200);
}
</script>

</body>
</html>
